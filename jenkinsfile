@Library('my-shared-library') _

pipeline {
  

  agent any
  /*
  tools {

  // Global Tool Configuration

  maven 'maven-3.9'


  }

  */
  parameters{
  	choice(name: 'action', choices: 'create\ndelete', description: 'Choose create/Destroy')

  }
   

  stages{

        // when { expression {  params.action == 'create' } }
     
    stage('Git CheckOut') {

       when { expression {  params.action == 'create' } }

      steps{
      
      gitCheckOut(

        branch: "main",

        url: "https://github.com/vikashmuktha/E2E-Jenkinsfile-ECR-Mr.DevOps.git"

      )

      }


    }

    stage('Unit Test'){

       when { expression {  params.action == 'create' } }

      steps{

        script{

        mvnTest()
        
        }
        
      }
    }
    
    stage('Integration Test'){

       when { expression { params.action == 'create' } }

      steps{

        script{

          mvnIntegrationTest()

        }
      }
    }
    
    stage ('Static Code Analysis') {

      // squ_255b8dcb40e746d3fc324f9a2769fea9345920c5

       when { expression { params.action == 'create' } }

      steps{

        script {

          def SonarQubecredentialsId = 'sonar-secret-1'
            statiCodeAnalysis(SonarQubecredentialsId)
                           
        }

      }

    }  
    
    stage ('Quality Gate Analysis') {

         when { expression { params.action == 'create' } }

      steps {

          script {

            def SonarQubecredentialsId = 'sonar-secret-1'
            QualityGateStatus(SonarQubecredentialsId)

          }
      }
    }
    /* 
    stage ('Maven Build') {

      when { expression { params.action == 'create' } }

      steps {

        script {

          mvnBuils()
        }
      }
    }
    */
    

  }

}
